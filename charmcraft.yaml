# This file configures Charmcraft.
# See https://canonical-charmcraft.readthedocs-hosted.com/en/stable/reference/files/charmcraft-yaml-file/
type: charm
name: headscale-k8s
title: Headscale
summary: Headscale is an open source, self-hosted implementation of the Tailscale control server.
description: |
  This charm deploys headscale on top of kubernetes.

links:
  contact: See github
  issues:
  - https://github.com/marcusboden/headscale-k8s-operator/issues
  source:
  - https://github.com/marcusboden/headscale-k8s-operator
  - https://github.com/juanfont/headscale

base: ubuntu@24.04
platforms:
  amd64:

assumes:
  - k8s-api
  - juju >= 3.1

parts:
    charm:
        source: .
        source-type: local

config:
  options:
    log-level:
      description: |
        Configures the log level of headscale.
      default: "info"
      type: string
    name:
      description: |
        Hostname of the headscale server
      default: headscale
      type: string
    policy:
      description: |
        Policy file to use, see https://headscale.net/stable/ref/acls/
      type: string
    magic-dns:
      description: Name of the tld for the magic DNS. Set to an empty string to disable magic dns
      type: string
      default: headscale

containers:
  headscale:
    resource: headscale-image

resources:
  headscale-image:
    type: oci-image
    description: |
      OCI image for the headscale container

      see https://github.com/marcusboden/headscale-rock

requires:
    traefik-route:
        interface: traefik_route
        limit: 1
        optional: true
